<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HTML to Excel Extractor</title>
</head>

<body>
	<h1>HTML to Excel Extractor</h1>

	<label for="html-file">Загрузите HTML-файл:</label>
	<input type="file" id="html-file" accept=".html" />
	<button id="process-btn">Обработать</button>


	<div id="preloader" class="preloader" style="display: none;">
		<div class="spinner"></div>
		<p>Обработка...</p>
	</div>

	<div id="download-section" style="display: none; margin-top: 20px;">
		<h3>Скачайте ваш файл:</h3>
		<a id="download-link" href="#" download="translations.xlsx">Скачать Excel</a>
	</div>

	<!-- <script>
		const processButton = document.getElementById('process-btn');
		const downloadSection = document.getElementById('download-section');
		const downloadLink = document.getElementById('download-link');
		const preloader = document.getElementById('preloader');

		// Функция для показа/скрытия прелоадера
		function showPreloader() {
			preloader.style.display = 'flex';
		}

		function hidePreloader() {
			preloader.style.display = 'none';
		}


		// Слушатель нажатия кнопки "Обработать"
		processButton.addEventListener('click', async () => {
			const fileInput = document.getElementById('html-file');
			if (!fileInput.files.length) {
				alert('Пожалуйста, загрузите HTML-файл!');
				return;
			}

			const file = fileInput.files[0];
			const formData = new FormData();
			formData.append('htmlFile', file);

			// Отправляем файл на сервер для обработки
			const response = await fetch('/upload', {
				method: 'POST',
				body: formData,
			});

			if (response.ok) {
				const blob = await response.blob();
				const url = URL.createObjectURL(blob);

				// Сохраняем файл в LocalStorage с таймером на 1 день
				// const expiryTime = Date.now() + 24 * 60 * 60 * 1000; // 1 день
				// localStorage.setItem('excelFile', JSON.stringify({ url, expiryTime }));

				// Отображаем ссылку для скачивания
				downloadLink.href = url;
				downloadSection.style.display = 'block';
			} else {
				alert('Ошибка обработки файла на сервере');
			}
		});

		// Проверяем LocalStorage на наличие файла
		// const savedFile = JSON.parse(localStorage.getItem('excelFile'));
		// if (savedFile && savedFile.expiryTime > Date.now()) {
		// 	downloadLink.href = savedFile.url;
		// 	downloadSection.style.display = 'block';
		// } else {
		// 	localStorage.removeItem('excelFile');
		// }
	</script> -->

	<script>
		const processButton = document.getElementById('process-btn');
		const downloadSection = document.getElementById('download-section');
		const downloadLink = document.getElementById('download-link');
		const preloader = document.getElementById('preloader');

		// Функция для показа/скрытия прелоадера
		function showPreloader() {
			preloader.style.display = 'flex';
		}

		function hidePreloader() {
			preloader.style.display = 'none';
		}

		// Слушатель нажатия кнопки "Обработать"
		processButton.addEventListener('click', async () => {
			const fileInput = document.getElementById('html-file');
			const urlInput = document.getElementById('url-input');

			// Показываем прелоадер перед началом обработки
			showPreloader();

			try {
				if (fileInput.files.length) {
					const file = fileInput.files[0];
					const reader = new FileReader();

					reader.onload = async () => {
						const htmlContent = reader.result;
						await processHTML(htmlContent);
					};

					reader.readAsText(file);
				} else if (urlInput.value.trim()) {
					const url = urlInput.value.trim();
					await processURL(url);
				} else {
					alert('Пожалуйста, загрузите файл или введите URL.');
				}
			} catch (error) {
				console.error('Ошибка обработки:', error);
				alert('Произошла ошибка. Попробуйте снова.');
			} finally {
				// Скрываем прелоадер после завершения обработки
				hidePreloader();
			}
		});

		// Обработка HTML-контента
		async function processHTML(htmlContent) {
			const response = await fetch('/api/extract', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ html: htmlContent }),
			});

			if (response.ok) {
				const blob = await response.blob();
				const url = URL.createObjectURL(blob);
				downloadLink.href = url;
				downloadSection.style.display = 'block';
			} else {
				alert('Ошибка обработки файла на сервере.');
			}
		}

		// Обработка ссылки
		async function processURL(url) {
			const response = await fetch('/api/extract', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ url }),
			});

			if (response.ok) {
				const blob = await response.blob();
				const url = URL.createObjectURL(blob);
				downloadLink.href = url;
				downloadSection.style.display = 'block';
			} else {
				alert('Ошибка обработки ссылки на сервере.');
			}
		}
	</script>

</body>

</html>